<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@5"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body>
    <ul
      class="menu menu-vertical lg:menu-horizontal bg-base-200 rounded-box w-full"
    >
      
      <li>
        <a href="index.html" class="text-center w-40 right flex ms-320 bg-red-500 text-white"
          >Logout</a
        >
      </li>
    </ul>
    <div>
      <h1 class="my-5 text-4xl text-blue-500 font-bold text-center">
        KELOLA BARANG
      </h1>
      
      
        <div
          class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100"
        >
          <table class="table">
            <tr>
              <th><h1>Pilih Barang</h1></th>
              <th><h1>Telepon</h1></th>
              <th><h1>Nama Pelanggan</h1></th>
              <th><h1>Harga Satuan</h1></th>
              <th><h1>Quantitas</h1></th>
              <th><h1>Total Harga</h1></th>
            </tr>
            <tr>
              <td>
                <select class="select" id="select-c">
                    <option value="pilih">pilih</option>
                </select>
                
              </td>
              <td>
                <input type="text" name="" id="telepon" class="input w-40" />
              </td>
              <td>
                <input type="text" name="" id="nama" class="input w-40" />
              </td>
              <td>
                <input type="text" name="" id="harga_satuan" class="input w-40" />
              </td>
              <td>
                <input type="text" name="" id="jumlah_barang" class="input w-40" />
              </td>
              <td>
                <input
                  type="number"
                  name=""
                  id="total"
                  class="input w-50"
                />
              </td>
              <td><button onclick="addKeranjang()" class="btn bg-green-500 text-white">Tambah</button>
            <button onclick="updateUser()" class="btn bg-yellow-500 text-white">Update</button></td>

              <input type="hidden" id="userId" />
            </tr>
            
          </table>
        </div>
        <div
          class=" mt-5 overflow-x-auto rounded-box border border-base-content/5 bg-base-100"
        >
          <table class="table" id="table">
            <!-- head -->
            <thead>
              <tr>
                <th>No Transaksi</th>
                <th>Kode Barang</th>
                <th>Nama Barang</th>
                <th>Qty</th>
                <th>Satuan</th>
                <th>Harga Satuan</th>
              </tr>
            </thead>
            <tbody id="content">

            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      const supabaseUrl = "https://sracjpyrnpatfgiugqaa.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyYWNqcHlybnBhdGZnaXVncWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NTY0NjIsImV4cCI6MjA2MTAzMjQ2Mn0.Wq7BALABhNUIeIGkUsCGX0bHsoPOqd5IUArXVkWQG9o";
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
      const telepon = document.getElementById("telepon")
      const nama = document.getElementById("nama")
      const harga = document.getElementById("harga_satuan")
      const qty = document.getElementById("jumlah_barang")
      const total = document.getElementById("total")
      const kode_barang = document.getElementById("select-c")
      const content = document.getElementById("content")

      const fetchAllBarang = async () => {
        const {data} = await supabase.from("tbl_barang").select("*");
        console.log(data)
        data.map((d) => {
            const opt = document.createElement("option");
            opt.innerHTML = d.kode_barang
            kode_barang.append(opt)
        })
      }

      fetchAllBarang()
      
      
      
      

      

      const data = []

      const addKeranjang = () => {
        const inv = `INV-${Date.now()}`
        const teleponValue = telepon.value
        const namaValue = nama.value
        const hargaValue = harga.value
        const qtyValue = qty.value
        const totalValue = total.value
        const kode_barangValue = kode_barang.value
        const newItems = {
            no_transaksi: inv,
            kode_barang: kode_barangValue,
            nama_barang: "uhasfg",
            qty: qtyValue,
            satuan: "pcs",
            harga_total : teleponValue,

        }
        const dataUpdate = [...data,newItems]
        data.push(newItems)
        fetchAllData()
      }
      const fetchAllData = () => {
          data.forEach((d) => {
            console.log("jalan")
            const tr = document.createElement("tr")
            tr.innerHTML = `
            <td>${d.no_transaksi}</td>
            <td>${d.kode_barang}</td>
            <td>${d.nama_barang}</td>
            <td>${d.qty}</td>
            <td>${d.satuan}</td>
            <td>${d.harga_total}</td>

            `
            content.append(tr)
        })
      }


      kode_barang.addEventListener("change", async function () {
        const { data, error } = await supabase
          .from("tbl_barang")
          .select("harga_satuan")
          .eq("kode_barang", kode_barang.value)
          .single();
        console.log(data);
        harga.value = `${data.harga_satuan}`;
      });

      qty.addEventListener("change", async function () {
        console.log(qty);
        total.value = qty.value * harga.value;
        console.log(qty.value);
        console.log(harga.value);
      });
      async function dataBarang() {
        const { data, error } = await supabase.from("tbl_barang").select("*");
        console.log(data);
        console.log(kode_barang);
        data.forEach((data) => {
          option = document.createElement("option");
          option.innerHTML = `
            <option value="${data.kode_barang}">${data.kode_barang}</option>
            `;
          kode_barang.appendChild(option);
        });
      }
      dataBarang()

      telepon.addEventListener("change", async function () {
        const teleponValue = telepon.value;
        const { data, error } = await supabase
          .from("tbl_pelanggan")
          .select("*")
          .eq("telepon", teleponValue)
          .single();
        if (data || !error) {
          nama.value = data.nama;
          nama.disabled = true;
        } else {
          nama.disabled = false;
          nama.value = "";
        }
      });
      
    </script>
  </body>
</html>
