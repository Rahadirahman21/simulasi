<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@5"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>
  <body>
    <ul
      class="menu menu-vertical lg:menu-horizontal bg-base-200 rounded-box w-full"
    >
      
      <li>
        <a href="index.html" class="text-center w-40 right flex ms-320 bg-red-500 text-white"
          >Logout</a
        >
      </li>
    </ul>
    <div>
      <h1 class="my-5 text-4xl text-blue-500 font-bold text-center">
        FORM TRANSAKSI
      </h1>
      
      
        <div
          class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100"
        >
          <table class="table">
            <tr>
              <th><h1>Kode Barang</h1></th>
              <th><h1>Jumlah Barang</h1></th>
              <th><h1>Nama Barang</h1></th>
              <th><h1>Satuan</h1></th>
              <th><h1>Expired Date</h1></th>
              <th><h1>Harga Barang</h1></th>
            </tr>
            <tr>
              <td>
                  <input type="text" name="" id="kode_barang" class="input w-40" />
                
              </td>
              <td>
                <input type="text" name="" id="jumlah_barang" class="input w-40" />
              </td>
              <td>
                <input type="text" name="" id="nama_barang" class="input w-40" />
              </td>
              <td>
                <input type="text" name="" id="satuan" class="input w-40" />
              </td>
              <td>
                <input type="date" name="" id="expired_date" class="input w-40" />
              </td>
              <td>
                <input
                  type="number"
                  name=""
                  id="harga_satuan"
                  class="input w-50"
                />
              </td>
              <td><button onclick="addUser()" class="btn bg-green-500 text-white">Tambah</button>
            <button onclick="updateUser()" class="btn bg-yellow-500 text-white">Update</button></td>

              <input type="hidden" id="userId" />
            </tr>
            
          </table>
        </div>
        <div
          class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100"
        >
          <table class="table" id="table">
            <!-- head -->
            <thead>
              <tr>
                <th>ID Barang</th>
                <th>Kode Barang</th>
                <th>Nama Barang</th>
                <th>Expired Date</th>
                <th>Qty</th>
                <th>Satuan</th>
                <th>Harga Satuan</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      const supabaseUrl = "https://sracjpyrnpatfgiugqaa.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyYWNqcHlybnBhdGZnaXVncWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NTY0NjIsImV4cCI6MjA2MTAzMjQ2Mn0.Wq7BALABhNUIeIGkUsCGX0bHsoPOqd5IUArXVkWQG9o";
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      async function addUser() {
        const kode_barang = document.getElementById("kode_barang").value;
        const nama_barang = document.getElementById("nama_barang").value;
        const expired_date = document.getElementById("expired_date").value;
        const jumlah_barang = document.getElementById("jumlah_barang").value;
        const satuan = document.getElementById("satuan").value;
        const harga_satuan = document.getElementById("harga_satuan").value

        const { data, error } = await supabase.from("tbl_barang").insert([
          {
            kode_barang: kode_barang,
            nama_barang: nama_barang,
            expired_date: expired_date,
            jumlah_barang: jumlah_barang,
            satuan: satuan,
            harga_satuan: harga_satuan,
          },
        ]);
        loadUser();
      }
      async function editUser(user) {
        document.getElementById("userId").value = user.id_barang;
        document.getElementById("kode_barang").value = user.kode_barang;
        document.getElementById("nama_barang").value = user.nama_barang;
        document.getElementById("expired_date").value = user.expired_date;
        document.getElementById("jumlah_barang").value = user.jumlah_barang;
        document.getElementById("satuan").value = user.satuan;
        document.getElementById("harga_satuan").value = user.harga_satuan;
      }
      async function updateUser() {
        const userId = document.getElementById("userId").value;
        const kode_barang = document.getElementById("kode_barang").value;
        const nama_barang = document.getElementById("nama_barang").value;
        const expired_date = document.getElementById("expired_date").value;
        const jumlah_barang = document.getElementById("jumlah_barang").value;
        const satuan = document.getElementById("satuan").value;
        const harga_satuan = document.getElementById("harga_satuan").value

        const { data, error } = await supabase
          .from("tbl_barang")
          .update({
            kode_barang: kode_barang,
            nama_barang: nama_barang,
            expired_date: expired_date,
            jumlah_barang: jumlah_barang,
            satuan: satuan,
            harga_satuan: harga_satuan,
          })
          .eq("id_barang", userId);
loadUser();
        
      }

      async function deleteUser(userId) {
        const { data, error } = 
        await supabase.from("tbl_barang").delete().eq("id_barang", userId);
        loadUser();
      }

      async function loadUser() {
        const { data, error } = await supabase.from("tbl_barang").select("*");

        const table = document.getElementById("table");
        table.innerHTML = `
          <tr>
                <th>ID Barang</th>
                <th>Kode Barang</th>
                <th>Nama Barang</th>
                <th>Expired Date</th>
                <th>Qty</th>
                <th>Satuan</th>
                <th>Harga Satuan</th>
                <th>Aksi</th>
              </tr>
          `;

        data.forEach((user, index) => {
          row = document.createElement("tr");
          row.innerHTML = `
              <td>${index + 1}</td>
              <td>${user.kode_barang}</td>
              <td>${user.nama_barang}</td>
              <td>${user.expired_date}</td>
              <td>${user.jumlah_barang}</td>
              <td>${user.satuan}</td>
              <td>${user.harga_satuan}</td>
            <button type="button" onclick='editUser(${JSON.stringify(user)})' class="ms-2 mb-2 rounded bg-yellow-500 w-20 h-8 text-white">Edit</button>
            <button type="button" onclick='deleteUser(${user.id_barang})' class="ms-2  rounded bg-red-500 w-20 h-8 text-white">Hapus</button>

              `;
          table.appendChild(row);
        });
      }
      const hiddenIdInput = document.createElement("input");
      hiddenIdInput.type = "hidden";
      hiddenIdInput.id = "userId";
      document.body.appendChild(hiddenIdInput);
      loadUser();
    </script>
  </body>
</html>
